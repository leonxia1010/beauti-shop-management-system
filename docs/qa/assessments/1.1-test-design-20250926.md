# Test Design: Story 1.1 – Monorepo Baseline Setup

Date: 2025-09-26  
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 10
- By level: Unit 2 (20%), Integration 7 (70%), E2E 1 (10%)
- Priority distribution: P0 0, P1 6, P2 3, P3 1
- Risk coverage: TECH-001, TECH-002, OPS-001, OPS-002 fully addressed

## Test Scenarios by Acceptance Criteria

### AC1 – Scaffold Nx workspace with four applications (admin-web, mobile-app, api-gateway, batch-jobs) using prescribed frameworks

| ID          | Level       | Priority | Test Description                                                                 | Justification                                                                              | Mitigates |
| ----------- | ----------- | -------- | -------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------ | --------- |
| 1.1-INT-001 | Integration | P1       | Run `nx build admin-web` to ensure Vite React target compiles with shared config | Validates Nx workspace wiring, shared Tailwind/shadcn setup, and TS path alias resolution  | TECH-001  |
| 1.1-INT-002 | Integration | P1       | Run `nx build api-gateway` and `nx test api-gateway`                             | Confirms NestJS target integrates with Nx executors and Jest harness                       | TECH-001  |
| 1.1-INT-003 | Integration | P1       | Execute `nx run mobile-app:start` (Expo) and smoke test CLI startup              | Highest-risk integration between Expo and Nx; ensures Metro bundler works within workspace | TECH-002  |
| 1.1-INT-004 | Integration | P2       | Validate `nx build batch-jobs` target produces runnable worker artifact          | Ensures background worker configuration shares infra and tsconfig correctly                | TECH-001  |

### AC2 – Create shared libraries with path aliases and lint configuration

| ID           | Level       | Priority | Test Description                                                                         | Justification                                                              | Mitigates |
| ------------ | ----------- | -------- | ---------------------------------------------------------------------------------------- | -------------------------------------------------------------------------- | --------- |
| 1.1-UNIT-001 | Unit        | P1       | Import sample type from `libs/domain` into scratch spec to confirm tsconfig path mapping | Low-cost verification that shared libraries compile and exports resolve    | TECH-001  |
| 1.1-INT-005  | Integration | P2       | Run `nx lint libs-domain libs-ui libs-auth libs-data-access libs-infra`                  | Confirms shared lint config applies uniformly and catches structural drift | OPS-002   |

### AC3 – Configure root tooling (ESLint, Prettier, lint-staged) with npm scripts

| ID           | Level       | Priority | Test Description                                                                 | Justification                                                                     | Mitigates |
| ------------ | ----------- | -------- | -------------------------------------------------------------------------------- | --------------------------------------------------------------------------------- | --------- |
| 1.1-INT-006  | Integration | P1       | Execute `npm run lint && npm run test && npm run build` sequentially in CI shell | Ensures core automation pipeline works via npm (canonical) and covers all targets | OPS-002   |
| 1.1-UNIT-002 | Unit        | P2       | Static check that `package.json` + lint-staged config include required commands  | Guards against accidental pnpm references or missing lint/format hooks            | OPS-002   |

### AC4 – Provide docker-compose stack with API, PostgreSQL, Redis, admin web assets

| ID          | Level       | Priority | Test Description                                                                                   | Justification                                                                                      | Mitigates |
| ----------- | ----------- | -------- | -------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- | --------- |
| 1.1-E2E-001 | E2E         | P1       | `docker compose up --build` smoke: verify API health endpoint, DB migrations, Redis availability   | Full-stack validation of local environment parity; catches port/env mismatches before feature work | OPS-001   |
| 1.1-INT-007 | Integration | P2       | Validate `.env.example` against compose definitions (variables present, default values documented) | Ensures Secrets Manager parity and prevents missing env keys                                       | OPS-001   |

### AC5 – Configure GitHub Actions pipeline (lint/test/build + Docker image)

| ID          | Level       | Priority | Test Description                                                                         | Justification                                                                   | Mitigates         |
| ----------- | ----------- | -------- | ---------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- | ----------------- |
| 1.1-INT-008 | Integration | P1       | Dry-run GitHub Actions workflow via `act` (or pipeline sandbox) covering lint/test/build | Validates CI matrix and early failure detection for workspace misconfigurations | TECH-001, OPS-002 |
| 1.1-INT-009 | Integration | P3       | Verify README badge target and workflow name stay in sync                                | Low-risk documentation alignment; ensures visibility of pipeline status         | —                 |

## Risk Coverage Summary

- **TECH-001 (Nx misconfiguration):** 1.1-INT-001/002/004/005/006/008 ensure build, lint, and CI flows catch miswiring.
- **TECH-002 (Expo within Nx):** 1.1-INT-003 explicitly exercises Expo start; flagged P1.
- **OPS-001 (docker-compose parity):** 1.1-E2E-001 and 1.1-INT-007 validate stack alignment and env contracts.
- **OPS-002 (npm vs pnpm drift):** 1.1-INT-005/006/008 and 1.1-UNIT-002 enforce npm-first policy across automation.

## Recommended Execution Order

1. P1 Integration tests (1.1-INT-001/002/003/006/008) – fail fast on workspace, Expo, npm tooling.
2. P1 E2E test (1.1-E2E-001) – ensures local environment parity before features branch off.
3. Remaining P2 tests (1.1-INT-004/005/007, 1.1-UNIT-001/002) – solidify shared libs and documentation.
4. P3 documentation sync (1.1-INT-009) – execute once primary validations pass.

## Gate YAML Block

```yaml
test_design:
  scenarios_total: 10
  by_level:
    unit: 2
    integration: 7
    e2e: 1
  by_priority:
    p0: 0
    p1: 6
    p2: 3
    p3: 1
  coverage_gaps: []
```

## Trace References

Test design matrix: docs/qa/assessments/1.1-test-design-20250926.md  
P0 tests identified: 0
