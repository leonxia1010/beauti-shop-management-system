# beauty-shop-management-system Product Requirements Document (PRD)

## Goals and Background Context

### Goals

- 提升五家门店的财务透明度，让合伙人每日掌握收入、成本与现金交接情况。
- 建立标准化现金交接流程，确保发现的差异能当日识别并跟进。
- 为多门店、合伙人、自由美容师协作打造低门槛的数字化工具，兼容现有手工流程并支持未来实时化演进。

### Background Context

目前五家门店沿用手工表格处理每日收入与成本，现金多由美容师代收，合伙人需定期对账。但缺乏统一系统导致数据滞后、异常难以追踪，利润分配与信任基础受到冲击。
beauty-shop-management-system 的目标是把高频财务场景数字化，以模板批量导入与移动端录入兼容现有习惯；通过异常提醒、现金交接批次管理、利润拆账等能力，让每日经营状态一目了然，并为后续 OCR、实时录入、AI 风控所需的数据基础做好铺垫。

### Change Log

| Date       | Version | Description                                        | Author |
| ---------- | ------- | -------------------------------------------------- | ------ |
| 2025-09-25 | v0.1    | Initial draft of Goals & Background Context        | John   |
| 2025-09-25 | v0.2    | Added requirements, UI goals, plan, metrics, risks | John   |

## Requirements

### Functional

- **FR1:** 系统必须支持门店管理员通过模板批量导入每日收入数据，并允许在系统内逐条新增或编辑记录，以方便及时修正。
- **FR2:** 成本录入需覆盖门店、类别、付款人等维度，并支持按照配置规则分摊至各门店或利润计算。
- **FR3:** 现金交接批次管理需支持“美容师 → 主合伙人”以及“合伙人 ↔ 合伙人”两类交接流程，提供批次创建、期望金额与实收金额对比、差异原因记录、审批与日志追踪。
- **FR4:** 系统要依据 4/6 分成规则自动计算合伙人利润，并记录美容师补贴对净收入的影响。
- **FR5:** 生成日结、月度及异常报表，支持按门店/美容师等维度查看，并导出 Excel/PDF。
- **FR6:** 实现角色权限控制，确保合伙人、门店管理员、美容师等角色仅能访问授权数据。
- **FR7:** 美容师可通过移动端录入个人服务记录、现金交接及补贴请求，便于后续对账。
- **FR8:** 合伙人或门店管理员可登记每日预约/预期服务记录，含门店、时间、项目、美容师等信息，供后续核对。
- **FR9:** 系统应基于可配置规则（如预约 vs. 实际、期望 vs. 实收差异、历史均值）在录入或结算后标记潜在异常，并提醒人工复核。
- **FR10:** 关键操作（数据录入、审批、利润分配等）需记录操作人、时间与变更内容，形成可审计日志。

### Non Functional

- **NFR1:** 界面须支持低文化水平用户快速上手，关键录入流程的操作步骤不超过 3 步，并提供明确的错误提示。
- **NFR2:** 日结和月度报表生成时间 ≤ 3 秒；单笔收入或现金交接提交的响应时间 ≤ 1 秒（在网络正常情况下）。
- **NFR3:** 系统可用性目标为 99%，发生故障时 4 小时内恢复核心录入与查询能力。
- **NFR4:** 所有数据传输须使用 HTTPS/TLS，敏感数据在数据库端加密存储；关键操作需保留审计日志至少 7 年。
- **NFR5:** 架构需允许后续扩展 OCR、语音输入、小程序等能力，不得与现有模块强耦合；新增终端必须复用统一 API。
- **NFR6:** 同一笔现金交接的审批与差异更新必须保持事务一致；系统需提供重试与差异核对机制，避免重复结算。
- **NFR7:** 必须具备基础监控与告警（错误率、队列积压、现金差异量等），便于运维快速定位问题。
- **NFR8:** 数据库需每日自动备份并保留 30 天；发生严重数据问题时，48 小时内可恢复到最近一次备份点。

## User Interface Design Goals

- **Overall UX Vision:** 管理后台强调清晰高效的财务操作，核心界面以数据表格与结构化表单为主，尽量做到一页完成批量导入、异常查看与处理。移动端 App 聚焦美容师/门店管理员的高频任务，采用极简操作与离线缓冲，保证在网络条件不佳情况下也能快速提交。整体视觉维持专业、可信赖风格，基于 shadcn/ui + NativeBase 的统一 design token，确保跨终端一致。
- **Design Documentation:**
  - UI/UX Specification: [docs/front-end-spec.md](./front-end-spec.md)
  - ASCII Layout Designs: [docs/ui-design/ascii-layouts.md](./ui-design/ascii-layouts.md)
  - UI Generation Prompts: [docs/ui-prompts.md](./ui-prompts.md)
- **Key Interaction Paradigms:**
  1. 分步表单（wizard）引导日终批量导入与校验。
  2. 异常列表提供筛选、批量处理、指派功能。
  3. 移动端采用大按钮、单手优先布局，预留拍照/扫码入口以支持未来 OCR。
  4. 现金交接流程统一使用“批次卡片 + 审批流”模式展示进度。
- **Core Screens and Views:** 登录/身份验证、日终收入录入（批量导入 + 单条编辑）、成本录入与分摊、现金交接批次（含美容师 → 合伙人、合伙人 ↔ 合伙人）、报表总览（日报、月报、异常列表）、美容师移动端（服务录入、补贴请求、现金交接提交）、异常详情与处理任务板。
- **Accessibility:** 暂无强制等级要求（None），但需遵循基础可访问性规范（语义标签、键盘操作支持、清晰输入校验提示）。
- **Branding:** 当前缺少企业 VI 手册，建议采用沉稳中性色配合品牌主色点缀，后续获得品牌指南后再统一调整。
- **Target Device and Platforms:** Web（PC 管理后台，兼容现代浏览器）与移动端 App（React Native，iOS/Android）；微信小程序暂不纳入 MVP，留作后续扩展。

## Technical Assumptions

- **Platform Requirements:** Web 端运行于现代浏览器（Chrome/Edge/Safari 最新版本），移动端 App 支持 iOS 13+ 与 Android 9+；关键操作在普通带宽下的交互时间 ≤1 秒，报表生成 ≤3 秒。
- **Technology Preferences:** 前端采用 Vite + React + TypeScript，UI 基于 shadcn/ui 与 Tailwind；移动端使用 React Native + NativeBase。后端基于 NestJS (TypeScript) + Prisma + PostgreSQL。数据库首选 Amazon RDS for PostgreSQL（Multi-AZ）。托管环境使用 AWS Elastic Beanstalk、S3、Cognito、SES、CloudWatch 等基础服务。
- **Architecture Considerations:** 采用 Nx Monorepo（apps + libs）并以 npm 管理依赖；短期内维持单体 NestJS 服务 + Worker（BullMQ）模式，保留未来按域拆分空间。集成要求涵盖 Excel/CSV 导入导出、SES 邮件通知。安全与合规需满足 HTTPS/TLS、最小权限 IAM、数据库加密、审计日志长期保留等要求。

## Release Strategy

- MVP 试点（目标 4-6 周）：选择 1 家门店闭环验证“日终录入 + 现金交接 + 报表输出”，并完成门店管理员、美容师的培训。
- 扩展推广（第 6-8 周）：逐步扩大到全部 5 家门店，建立每日使用节奏，引入合伙人之间的结算流程并收集反馈。
- 稳定运营（第 8 周以后）：根据反馈迭代增强（OCR、实时提醒等），完善文档、培训与运维手册，筹备后续商业推广。
- 培训与支持：上线前提供视频与简明操作手册，上线后一周安排专人巡检数据，确保异常及时处理。

## Implementation Plan

- **Epic 1：基础设施与日终录入**（Iteration 0-1）
  - 搭建 Nx Monorepo、CI/CD、认证与权限框架
  - 实现收入/成本批量导入、单条编辑与字段校验
  - 建立日结报表、异常列表雏形
- **Epic 2：现金交接与利润分配**（Iteration 1-2）
  - 完成现金交接批次、审批流、审计日志
  - 实现合伙人之间的拆账、补贴影响和利润展示
  - 打通异常识别规则（预约 vs. 实际、期望 vs. 实收）
- **Epic 3：移动端与角色体验**（Iteration 2-3）
  - 发布 React Native App（服务录入、补贴、交接提交）
  - 补全预约登记、通知提醒、角色定制报表
  - 优化性能、监控、备份策略，为 Post-MVP 功能铺垫
- **跨 Epic 支撑工作**：技术文档、监控告警、培训材料、数据导入脚本、运营支持流程。

## Success Metrics & Monitoring

- 日终报表生成时间 ≤ 3 秒；现金交接提交响应 ≤ 1 秒。
- MVP 试运行 1 个月内，5 家门店日均使用率 ≥ 90%。
- 现金交接差异当天识别率 ≥ 95%，异常处理完成时效 ≤ 48 小时。
- 因错报/漏报导致的财务纠纷数量下降 ≥ 70%。
- 合伙人对系统满意度 ≥ 4/5（上线后满意度访谈）。

## Open Questions & Risks

- **数据录入依赖人为操作**：若门店执行不到位，系统价值难体现——需要规划提醒与监督机制。
- **现金差异处理流程复杂**：须提前明确责任人与处理时限，形成 SOP。
- **预算限制**：OCR、实时提醒等增量功能可能需延后——需要根据商业回报评估投放节奏。
- **安全合规压力**：涉及现金与个人信息，需持续评估安全措施与合规要求。
- **开放问题**：
  - 是否需要支持多币种或外部支付渠道？
  - 合伙人是否希望接入第三方会计/税务系统？
  - 各门店是否存在差异化流程需要系统自定义？
