# Risk Profile – Story 1.1 (Monorepo Baseline Setup)

- **Story File:** `docs/stories/1.1.monorepo-baseline-setup.md`
- **Architecture References:**
  - Repository layout & tooling mandates – `docs/architecture/high-level-architecture.md`
  - Frontend/Expo guidance – `docs/architecture/frontend-architecture.md`
  - Backend & DevOps expectations – `docs/architecture/backend-architecture.md`, `docs/architecture/architecture-part3.md`
- **Assessment Date:** 2025-09-26
- **Assessor:** Quinn (QA)

## Summary

## Risk Matrix

| Risk ID  | Description                                                                 | Probability | Impact     | Score | Priority |
| -------- | --------------------------------------------------------------------------- | ----------- | ---------- | ----- | -------- |
| TECH-001 | Nx workspace misconfiguration causing cross-app builds to fail              | Medium (2)  | Medium (2) | 4     | Medium   |
| TECH-002 | Expo-managed React Native project fails to cooperate within Nx pipeline     | High (3)    | Medium (2) | 6     | High     |
| OPS-001  | docker-compose stack diverges from production assumptions (ports, env vars) | Medium (2)  | Medium (2) | 4     | Medium   |
| OPS-002  | npm-first tooling conflicts with existing pnpm assets, causing script drift | Medium (2)  | Low (1)    | 2     | Low      |

### Heat Map

- **High (Score ≥6):** TECH-002
- **Medium (Score =4):** TECH-001, OPS-001
- **Low (Score ≤3):** OPS-002

## Detailed Risk Register

| Risk ID  | Category    | Description                                                                                                                      | Affected Components                                       | Detection / Leading Indicators                                                                      | Mitigation & Owner                                                                                                                                                                          | Residual Notes                                                                                                   |
| -------- | ----------- | -------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- | --------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| TECH-001 | Technical   | Nx workspace not wired correctly for multi-app targets, causing shared libs to fail resolution or incorrect tsconfig paths.      | Nx workspace config, `apps/*`, `libs/*`, root `tsconfig`. | `nx graph`/`nx build` commands fail; path imports unresolved; lint step cannot locate libs.         | Use official Nx generators per architecture repo layout (Ref: highs-level architecture). Add CI job to run `nx affected --target=build`. QA to require dry-run before merging.              | Residual risk low once scripts run cleanly; monitor after adding more apps.                                      |
| TECH-002 | Technical   | Integrating Expo (managed workflow) into Nx monorepo is brittle; build scripts or Metro bundler may break in CI/CD.              | `apps/mobile-app`, Nx project.json, Expo CLI.             | Expo start fails inside Nx executor; CI Android/iOS builds fail; watchman errors locally.           | Follow Nx + Expo integration guide, pin Expo SDK to version tested with Node 20, validate both `nx run mobile-app:start` and `expo prebuild`. Include CI smoke job executing `expo doctor`. | Residual medium—document workaround in README; plan fallback to standalone Expo repo if blocking issues persist. |
| OPS-001  | Operational | docker-compose deviates from prod topology (wrong port mapping, missing env), undermining parity and masking integration issues. | `docker-compose.yml`, `.env.example`.                     | Developers rely on mocks; API cannot reach Postgres/Redis; env drift noticed during staging deploy. | Mirror service names/ports from architecture part3 (deployment & devops). Add README checklist to run compose before story sign-off. QA to verify compose boot log.                         | Residual low if compose validated and kept minimal.                                                              |
| OPS-002  | Operational | Mixing npm (canonical) and historical pnpm config leads to inconsistent lockfiles and scripts.                                   | Root package manager config, CI pipeline.                 | Both `package-lock.json` and `pnpm-lock.yaml` present; scripts referencing pnpm fail.               | Remove pnpm-specific scripts, document npm as canonical in README, enforce `npm install` in CI.                                                                                             | Residual low once repo policy documented.                                                                        |

## Mitigation Plan & Owners

- **TECH-002 (High):** Require early spike to confirm Expo SDK compatibility; record instructions in `README` > Mobile section. Owner: Dev Lead for mobile.
- **TECH-001 / OPS-001 (Medium):** Execute Nx build/lint/test matrix inside CI before merging; QA to review initial pipeline run artifacts. Owner: Platform engineer.
- **OPS-002 (Low):** Document npm-first policy and add `.npmrc` to lock settings. Owner: Repo maintainer.

## Risk-Based Testing Strategy

### Priority 1 – High Risk (TECH-002)

- Run `nx run mobile-app:start` locally to ensure Metro bundler works inside Nx.
- Execute `expo doctor` and (if feasible) `expo prebuild` in CI to surface managed workflow issues.
- Include smoke E2E check (Detox placeholder) ensuring mobile project bootstraps without runtime config errors.

### Priority 2 – Medium Risks (TECH-001, OPS-001)

- `nx affected --target=build/test/lint` across all apps/libs after scaffolding.
- Validate path aliases by importing a shared type from `libs/domain` into each app.
- Bring up `docker compose up` and confirm API ↔ Postgres/Redis healthcheck via logs.

### Priority 3 – Low Risks (OPS-002)

- CI guard job verifying only `package-lock.json` present; run `npm ci` to detect drift.
- Manual review of README instructions for package manager usage.

## Deployment / Rollout Recommendations

- Keep Story 1.1 behind a temporary doc checkpoint; do not unblock business feature stories until Nx build + docker-compose flows succeed end-to-end.
- If Expo issues persist beyond two working days, consider temporarily splitting mobile app into standalone repo while evaluating Nx integration (documented fallback path).

## Monitoring & Follow-up

- Track initial CI run outputs—store artifact logs for Nx build, Expo doctor, docker-compose smoke test.
- Revisit risk profile once first domain feature story introduces actual runtime code (expected Story 1.2+). If new services/additional tooling added, re-run risk assessment.

---

Risk profile: `docs/qa/assessments/1.1-risk-20250926.md`
